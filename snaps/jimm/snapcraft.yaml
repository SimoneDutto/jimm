name: jimm
version: git
summary: Juju Intelligent Model Manager
description: Multi-cloud controller for managing JAAS models.
grade: stable
base: core18
confinement: strict

apps:
  jimm:
    command: bin/wrappers/jimm
    daemon: simple
    plugs:
     - network
     - network-bind

parts:
  jimm:
    plugin: gomod
    source: ../..
    source-type: git
    go-packages:
    - github.com/CanonicalLtd/jimm/cmd/jemd
    go-private:
    - github.com/CanonicalLtd
    prime:
     - bin/jemd
    override-build: |
      set -ex
      GIT_COMMIT=`git -C $SNAPCRAFT_PART_SRC rev-parse --verify HEAD`
      GIT_VERSION=`git -C $SNAPCRAFT_PART_SRC describe --dirty`
      cp version/init.go.tmpl version/init.go
      gofmt -w -r "unknownVersion -> Version{GitCommit: \"${GIT_COMMIT}\", Version: \"${GIT_VERSION}\",}" version/init.go
      snapcraftctl build

  files:
    plugin: dump
    source: files
    organize:
      config.yaml: etc/jimm/config.yaml
      jimm.wrapper: bin/wrappers/jimm
    prime:
    - etc/jimm/config.yaml
    - bin/wrappers/jimm
